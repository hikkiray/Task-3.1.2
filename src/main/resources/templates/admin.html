<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel</title>
    <style>
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
      tr:nth-child(even) { background-color: #f2f2f2; }
      .action-form { display: inline; }
      .roles-checkboxes {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
          margin: 10px 0;
      }
      .role-checkbox {
          display: flex;
          align-items: center;
          gap: 5px;
      }
      .role-checkbox input[type="checkbox"] {
          margin: 0;
      }
      .header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
      }
      .logout-button {
          padding: 10px 20px;
          background-color: #dc3545;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          text-decoration: none;
      }
      .logout-button:hover {
          background-color: #c82333;
      }
    </style>
</head>
<body>
    <div class="header">
        <h1>Панель администратора</h1>
        <form th:action="@{/logout}" method="post" class="action-form">
            <button type="submit" class="logout-button">Выйти</button>
        </form>
    </div>

    <h2>Добавить пользователя</h2>
    <form th:action="@{/admin/add}" method="post">
      Имя: <input type="text" name="name" required><br>
      Логин: <input type="text" name="username" required><br>
      Пароль: <input type="password" name="password" required><br>
      Email: <input type="email" name="email" required><br>
      Возраст: <input type="number" name="age" required><br>
      Роли:
      <div class="roles-checkboxes">
          <div th:each="role : ${allRoles}" class="role-checkbox">
              <input type="checkbox" 
                     name="roles" 
                     th:value="${role.id}" 
                     th:id="'new-role-' + ${role.id}">
              <label th:for="'new-role-' + ${role.id}" th:text="${role.name}"></label>
          </div>
      </div>
      <button type="submit">Добавить</button>
    </form>

    <h2>Список пользователей</h2>
    <table>
      <thead>
      <tr>
        <th>ID</th>
        <th>Имя</th>
        <th>Логин</th>
        <th>Email</th>
        <th>Возраст</th>
        <th>Роли</th>
        <th>Действия</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="user : ${users}">
        <td th:text="${user.id}"></td>
        <td th:text="${user.name}"></td>
        <td th:text="${user.username}"></td>
        <td th:text="${user.email}"></td>
        <td th:text="${user.age}"></td>
        <td>
          <span th:each="role : ${user.roles}"
                th:text="${role.name} + ' '"></span>
        </td>
        <td>
          <!-- Форма редактирования -->
          <form th:action="@{/admin/update}" method="post" class="action-form">
            <input type="hidden" name="id" th:value="${user.id}">
            <input type="text" name="name" th:value="${user.name}" required>
            <input type="text" name="username" th:value="${user.username}" required>
            <input type="email" name="email" th:value="${user.email}" required>
            <input type="number" name="age" th:value="${user.age}" required>
            <input type="password" name="password" placeholder="Новый пароль">
            Роли:
            <div class="roles-checkboxes">
                <div th:each="role : ${allRoles}" class="role-checkbox">
                    <input type="checkbox" 
                           name="roles" 
                           th:value="${role.id}" 
                           th:id="'role-' + ${role.id}"
                           th:checked="${user != null && user.roles.contains(role)}">
                    <label th:for="'role-' + ${role.id}" th:text="${role.name}"></label>
                </div>
            </div>
            <button type="submit">Обновить</button>
          </form>

          <!-- Форма удаления -->
          <form th:action="@{/admin/delete}" method="post" class="action-form">
            <input type="hidden" name="id" th:value="${user.id}">
            <button type="submit">Удалить</button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
</body>
</html>